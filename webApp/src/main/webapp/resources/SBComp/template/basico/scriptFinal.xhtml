<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:SBDev="http://xmlns.jcp.org/jsf/composite/resources/SBComp/composite/devel"
                xmlns:p="http://primefaces.org/ui">


    <h:panelGroup rendered="false">

        <p:socket
            rendered="false"
            channel="/mensagens/#{paginaAtual.infoPagina.acaoVinculada.nomeUnico}/#{sessaoAtualSBWP.usuario.grupo.email}/#{sessaoAtualSBWP.usuario.email}"
            onMessage="notificacoesPush" />

        <h:form id="formularioComunicacao" >

            <h:inputHidden  id="codigoComunicacao" value="#{pgUtilComunicacao.codigoComunicacao}" class="codigoComunicado" />
            <p:commandButton   widgetVar="botaoAbrirModalConversa" update="@form"
                               style="display:none"  actionListener="#{pgUtilComunicacao.exibirModalComunicacaoCodigo()}">

                <p:ajax event="dialogReturn"

                        update="#{pgUtil.gerarCaminhoCompletoID(layoutIdsAreasConhecidas.AREA_TOPO_ITERNFACES)}"
                        />

            </p:commandButton>
        </h:form>

        <h:panelGroup rendered="false" >
            <script type="text/javascript" >
                function notificacoesPush(notificacao) {
                    console.log(notificacao);
                    if (notificacao.temMensagem) {
                        PF("#{layoutIdsAreasConhecidas.AREA_MENSAGEM_INTERFACE}").renderMessage(JSON.parse(notificacao.mensagemJson));
                    }
                    if (notificacao.temCodigoConversa) {

                        responderConversa(notificacao.codigoConversa);
                    }
                }
                function responderConversa(codigoSelo) {
                    (document.getElementById('formularioComunicacao:codigoComunicacao')).value = codigoSelo;
                    PF('botaoAbrirModalConversa').jq.click();

                }
            </script>
        </h:panelGroup>
    </h:panelGroup>

</ui:composition>








