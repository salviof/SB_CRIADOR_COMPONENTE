<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:p="http://primefaces.org/ui"

      xmlns:SBObjeto="http://xmlns.jcp.org/jsf/composite/SBComp/composite/objetos"
      xmlns:SBDevel="http://xmlns.jcp.org/jsf/composite/SBComp/composite/devel"
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
      xmlns:f="http://xmlns.jcp.org/jsf/core">

    <h:body>
        <ui:composition>
            TESTESSS
            <c:forEach items="#{sessaoAtualSBWP.menusDaSessao.menuAvancado.sessoes}" var="sessao1" >
                #{sessao1.nome}

                <c:forEach items="#{sessao1.acoes}" var="acao" >
                    #{acao.nomeAcao}
                </c:forEach>
            </c:forEach>
            <c:forEach items="#{sessaoAtualSBWP.menusDaSessao.menuPrincipal.sessoes}" var="sessao2" >
                #{sessao2.nome}

                <c:forEach items="#{sessao2.acoes}" var="acao2" >
                    #{acao2.nomeAcao}
                </c:forEach>
            </c:forEach>
            <p:separator/>

            /mensagens/#{paginaAtual.infoPagina.acaoVinculada.nomeUnico}/#{sessaoAtualSBWP.usuario.grupo.nomeUnico}/#{sessaoAtualSBWP.usuario.email}

            <h:form>
                <p:commandButton actionListener="#{pgUtil.testePush()}" value="Teste Push" />
            </h:form>

            <h:form>
                <p:commandButton actionListener="#{pgUtil.testePushConversa()}" value="Teste Push Comunicação" >
                </p:commandButton>
            </h:form>




            <c:forEach var="comunicacao" items="#{sessaoAtualSBWP.comunicacaoAguardandoRespostaUsuarioSesso}" >
                <c:forEach items="#{comunicacao.repostasPossiveis}" var="resp" >
                    #{resp.tipoResposta.icone}
                </c:forEach>

            </c:forEach>


            <script type="text/javascript" >
                function handleMessage(notificacao) {
                    console.log(notificacao);
                    if (notificacao.temMensagem) {
                        PF("mensagemUsuario").renderMessage(JSON.parse(notificacao.mensagemJson));
                    }
                    if (notificacao.temCodigoConversa) {

                        responderConversa(notificacao.codigoConversa);
                    }
                }
                function responderConversa(codigoSelo) {
                    (document.getElementById('formularioComunicacao:codigoComunicacao')).value = codigoSelo;
                    PF('botaoAbrirModalConversa').jq.click();

                }
            </script>
            <p:socket channel="/mensagens/#{paginaAtual.infoPagina.acaoVinculada.nomeUnico}/#{sessaoAtualSBWP.usuario.grupo.email}/#{sessaoAtualSBWP.usuario.email}"  onMessage="handleMessage" >
            </p:socket>
            <h:form id="formularioComunicacao" >

                <h:inputHidden  id="codigoComunicacao" value="#{pgUtilComunicacao.codigoComunicacao}" class="codigoComunicado" />
                <p:commandButton   widgetVar="botaoAbrirModalConversa" update="@form"
                                   style="display:none"  actionListener="#{pgUtilComunicacao.exibirModalComunicacaoCodigo()}">

                    <p:ajax event="dialogReturn"

                            update="#{pgUtil.gerarCaminhoCompletoID('topoSBForm')}"
                            />

                </p:commandButton>
            </h:form>


            <SBDevel:infoPagina/>
        </ui:composition>








    </h:body>
</html>